// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  CUSTOMER
  EMPLOYEE
  ADMIN
}

enum Gender {
  MALE
  FEMALE
  NON_BINARY
}

model User {
  id        String    @id @default(cuid())
  createAt  DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  email             String  @unique
  password          String
  phone             String?
  firstName         String
  middleName        String?
  lastName          String
  gender            Gender?
  preferredLanguage String? @default("en")
  role              Role?   @default(CUSTOMER)

  // Relations
  address           Address[] @relation(name: "User_address")
  from_Address_user Address[] @relation(name: "Address_user")
  cart              Cart?     @relation(name: "Cart_user")
  orders            Order[]   @relation(name: "Order_user")
  reviews           Review[]  @relation(name: "Review_user")

  @@map("user")
}

model Address {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  addressLine1 String
  addressLine2 String?
  municipality String
  region       String
  country      String
  postalCode   String

  isBillingAddress  Boolean?
  isPrimaryAddress  Boolean
  isShippingAddress Boolean?
  isValidAddress    Boolean?
  poBox             Boolean?

  user              User   @relation(name: "Address_user", fields: [userId], references: [id])
  userId            String
  from_User_address User[] @relation(name: "User_address")

  @@unique([userId])
  @@map("address")
}

enum ContactType {
  PHONE
  EMAIL
  TEXT
}

model Category {
  id        String    @id @default(cuid())
  createAt  DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  code        String?
  description Json?   @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  name        String  @unique
  url         String

  // Relations
  parent               Category?  @relation(name: "Category_parent", fields: [parentId], references: [id])
  parentId             String?
  from_Category_parent Category[] @relation(name: "Category_parent")

  products              Product[] @relation(name: "Category_products")
  from_Product_category Product[] @relation(name: "Product_categories")

  @@unique([parentId])
  @@map("category")
}

model Cart {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products CartProduct[] @relation(name: "Cart_products")

  user   User   @relation(name: "Cart_user", fields: [userId], references: [id])
  userId String

  @@unique([userId])
  @@map("cart")
}

model CartProduct {
  id        String   @id @default(cuid())
  product   Product? @relation(name: "CartProduct_product", fields: [productId], references: [id])
  productId String?
  amount    Int      @default(0)

  from_Cart_products Cart[] @relation(name: "Cart_products")

  @@unique([productId])
  @@map("cartproduct")
}

enum OrderStatusType {
  CREATED
  PENDING
  SUCCESSFUL
  CANCELLED
}

model Order {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  products OrderDetail[]
  status   OrderStatusType?

  // Relations
  payment    Payment?  @relation(name: "Order_payment", fields: [paymentId], references: [id])
  paymentId  String?
  shipment   Shipment? @relation(name: "Order_shipment", fields: [shipmentId], references: [id])
  shipmentId String?
  user       User?     @relation(name: "Order_user", fields: [userId], references: [id])
  userId     String?

  from_Payment_order  Payment[]  @relation(name: "Payment_order")
  from_Shipment_order Shipment[] @relation(name: "Shipment_order")

  @@unique([paymentId, shipmentId, userId])
  @@map("order")
}

model OrderDetail {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  quantity Int   @default(0)
  total    Float

  // Relations
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   String
  product   Product @relation(fields: [productId], references: [id])
  productId String

  @@unique([orderId, productId])
  @@map("orderdetail")
}

enum PaymentStatusType {
  CREATED
  PENDING
  COMPLETED
}

model Payment {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  paymentMethod String
  status        PaymentStatusType?

  // Relations
  order   Order?  @relation(name: "Payment_order", fields: [orderId], references: [id])
  orderId String?

  from_Order_payment Order[] @relation(name: "Order_payment")

  @@unique([orderId])
  @@map("payment")
}

model Price {
  id        String    @id @default(cuid())
  createAt  DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  isoCurrencyCode String?  @default("USD")
  currentPrice    Int
  discounted      Boolean?
  formattedValue  String
  fullPrice       Int

  product            Product?  @relation(name: "Price_product", fields: [productId], references: [id])
  productId          String?
  from_Product_price Product[] @relation(name: "Product_price")

  @@unique([productId])
  @@map("price")
}

enum ImageFileType {
  PNG
  JPG
  WEBP
}

enum ImageFormat {
  LANDSCAPE
  PORTRAIT
  SQUARE
}

model ProductImage {
  id        String    @id @default(cuid())
  createAt  DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  altText     String?
  aspectRatio String?
  fileType    ImageFileType?
  format      ImageFormat?
  height      Int?
  width       Int?
  url         String?

  // Relations
  variant   ProductVariant? @relation(name: "ProductImage_variant", fields: [variantId], references: [id])
  variantId String?

  from_ProductVariant_images ProductVariant[] @relation(name: "ProductVariant_images")

  from_Product_images Product[] @relation(name: "Product_images")

  @@unique([variantId])
  @@map("productimage")
}

model ProductVariant {
  id        String    @id @default(cuid())
  createAt  DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  code   String? // allows concatenating of categories and ids
  name   String
  hex    String?
  swatch Json? // { "src": "https://...", "width": 80, "height": 55, "alt": "red" }

  product   Product? @relation(name: "ProductVariant_product", fields: [productId], references: [id])
  productId String?

  images ProductImage[] @relation(name: "ProductVariant_images")

  from_ProductImage_variant ProductImage[] @relation(name: "ProductImage_variant")
  from_Product_variants     Product[]      @relation(name: "Product_variants")

  @@unique([name, productId])
  @@map("productvariant")
}

enum ProductStatusType {
  AVAILABLE
  BACKORDER
  DISCONTINUED
  OUT_OF_STOCK
}

model Product {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  brand       String
  code        String? // allows concatenating of categories and ids
  description Json    @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")

  rating   Float?            @default(0)
  reviews  Review[]          @relation(name: "Product_reviews")
  status   ProductStatusType
  variants ProductVariant[]  @relation(name: "Product_variants")

  // Relations
  categories Category[]     @relation(name: "Product_categories")
  images     ProductImage[] @relation(name: "Product_images")
  orders     OrderDetail[]
  price      Price?         @relation(name: "Product_price", fields: [priceId], references: [id])
  priceId    String?
  stock      Stock?         @relation(name: "Product_stock", fields: [stockId], references: [id])
  stockId    String?

  from_Category_product       Category[]       @relation(name: "Category_products")
  from_Price_product          Price[]          @relation(name: "Price_product")
  from_CartProduct_product    CartProduct[]    @relation(name: "CartProduct_product")
  from_ProductVariant_product ProductVariant[] @relation(name: "ProductVariant_product")
  from_Review_product         Review[]         @relation(name: "Review_product")

  @@unique([priceId, stockId])
  @@map("product")
}

model Review {
  id        String    @id @default(cuid())
  createAt  DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  label   String
  rating  Int
  comment String?

  // Relations
  product   Product @relation(name: "Review_product", fields: [productId], references: [id])
  productId String
  user      User    @relation(name: "Review_user", fields: [userId], references: [id])
  userId    String

  from_Product_reviews Product[] @relation(name: "Product_reviews")

  @@unique([productId, userId])
  @@map("review")
}

model Stock {
  id        String    @id @default(cuid())
  createdAt DateTime? @default(now())
  updatedAt DateTime? @default(now()) @updatedAt

  quantity             Int?
  nextDelivery         DateTime?
  nextDeliveryQuantity Int?

  from_Product_stock Product[] @relation(name: "Product_stock")
  productId          String

  @@unique([productId])
  @@map("stock")
}

enum ShipmentStatusType {
  CREATED
  PENDING
  COMPLETED
}

model Shipment {
  id               String    @id @default(cuid())
  createdAt        DateTime? @default(now())
  lastModification DateTime? @default(now()) @updatedAt

  status ShipmentStatusType?

  order   Order?  @relation(name: "Shipment_order", fields: [orderId], references: [id])
  orderId String?

  from_Order_shipment Order[] @relation(name: "Order_shipment")

  @@unique([orderId])
  @@map("shipment")
}
